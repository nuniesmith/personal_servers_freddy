# ================================================
# CORS HEALTH CONFIGURATION FOR ALL SERVICES
# ================================================
# This file provides standardized CORS headers and error page directives
# to be included in all service configurations (emby, jellyfin, plex, etc.)
# 
# NO LOCATION BLOCKS - Only directives that work in server context
# Usage: Add 'include /etc/nginx/includes/cors_health.conf;' to each service

# ================================================
# ENHANCED SECURITY HEADERS (SHARED)
# ================================================

# Security Headers Block - Add to each service
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header X-XSS-Protection "1; mode=block" always;

# ================================================
# CORS HEADERS FOR DASHBOARD ACCESS
# ================================================

# Enhanced CORS headers for dashboard monitoring
add_header 'Access-Control-Allow-Origin' 'https://7gram.xyz' always;
add_header 'Access-Control-Allow-Credentials' 'true' always;
add_header 'Access-Control-Allow-Methods' 'GET, HEAD, OPTIONS, POST' always;
add_header 'Access-Control-Allow-Headers' 'Origin, X-Requested-With, Content-Type, Accept, Authorization, Cache-Control, Pragma' always;
add_header 'Access-Control-Expose-Headers' 'Content-Length, Content-Range, X-Response-Time' always;
add_header 'Access-Control-Max-Age' 86400 always;

# ================================================
# STANDARDIZED ERROR PAGE DIRECTIVES
# ================================================

# Custom Error Pages - Matching main domain structure
error_page 404 /errors/404.html;
error_page 500 /errors/500.html;
error_page 502 /errors/502.html;
error_page 503 /errors/503.html;
error_page 504 /errors/504.html;
error_page 401 @error401;

# ================================================
# USAGE INSTRUCTIONS
# ================================================

# To use this configuration in your service configs:
# 1. Include this file in each service server block:
#    include /etc/nginx/includes/cors_health.conf;
# 2. Include location blocks separately:
#    include /etc/nginx/includes/health_locations.conf;
# 3. Include error page locations:
#    include /etc/nginx/includes/error_locations.conf;
# 4. Test with: nginx -t
# 5. Reload: nginx -s reload
#
# This file provides:
# - Security headers for all services
# - CORS headers for dashboard access
# - Error page directives
#
# Separate files provide:
# - health_locations.conf - Health endpoint location blocks
# - error_locations.conf - Error page location blocks